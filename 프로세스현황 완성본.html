<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í”„ë¡œì„¸ìŠ¤ ì§„í–‰ í˜„í™©</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            navy: { 50: '#f0f3ff', 100: '#e0e7ff', 200: '#c7d2fe', 300: '#a5b4fc', 400: '#818cf8', 500: '#202454', 600: '#1a1d45', 700: '#141636', 800: '#0e1027', 900: '#080918' }
          },
          fontFamily: { pretendard: ['Pretendard', 'sans-serif'] }
        }
      }
    }
  </script>
  <style>
    * { font-family: 'Pretendard', sans-serif; }
    .status-tag { padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 500; }
    .task-row:hover { background: #f8fafc; }
    .group-header { cursor: pointer; user-select: none; }
    .group-header:hover { background: #f1f5f9; }
    .expand-icon { transition: transform 0.2s; }
    .expand-icon.collapsed { transform: rotate(-90deg); }
    .child-task { background: #fafbfc; }
    .side-panel { transform: translateX(100%); transition: transform 0.3s ease; }
    .side-panel.open { transform: translateX(0); }
    .fade-in { animation: fadeIn 0.3s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    /* í•„í„° ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
    .filter-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 4px;
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
      z-index: 100;
      min-width: 200px;
      display: none;
      overflow: hidden;
    }
    .filter-dropdown.show {
      display: block;
      animation: fadeIn 0.15s ease;
    }
    .filter-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      cursor: pointer;
      transition: all 0.15s;
      border-bottom: 1px solid #f1f5f9;
    }
    .filter-item:last-child {
      border-bottom: none;
    }
    .filter-item:hover {
      background: #f8fafc;
    }
    .filter-item.active {
      background: #eff6ff;
    }
    .filter-item .check-box {
      width: 20px;
      height: 20px;
      border: 2px solid #cbd5e1;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s;
      flex-shrink: 0;
    }
    .filter-item.active .check-box {
      background: #3b82f6;
      border-color: #3b82f6;
    }
    .filter-item .check-box svg {
      display: none;
      width: 14px;
      height: 14px;
      color: white;
    }
    .filter-item.active .check-box svg {
      display: block;
    }
    .filter-item .filter-label {
      flex: 1;
      font-size: 14px;
      color: #334155;
    }
    .filter-item.active .filter-label {
      color: #1d4ed8;
      font-weight: 500;
    }
    .filter-item .filter-count {
      font-size: 12px;
      color: #94a3b8;
      background: #f1f5f9;
      padding: 2px 8px;
      border-radius: 10px;
    }
    .filter-item.active .filter-count {
      background: #dbeafe;
      color: #3b82f6;
    }
    
    /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ */
    .toast-message {
      animation: slideUp 0.3s ease;
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translate(-50%, 20px); }
      to { opacity: 1; transform: translate(-50%, 0); }
    }
    
    /* ê·¸ë£¹ëª… í¸ì§‘ íŒíŠ¸ */
    .group-name-text {
      cursor: pointer;
      padding: 2px 4px;
      border-radius: 4px;
      transition: background 0.2s;
    }
    .group-name-text:hover {
      background: rgba(32, 36, 84, 0.08);
    }
    
    /* ê·¸ë£¹ëª… ì¸ë¼ì¸ í¸ì§‘ */
    .group-name-input {
      font-size: 14px;
      min-width: 120px;
    }
    .group-name-input:focus {
      box-shadow: 0 0 0 3px rgba(32, 36, 84, 0.15);
    }
  </style>
</head>
<body class="bg-slate-50 min-h-screen">
  
  <!-- í”„ë¡œì„¸ìŠ¤ í˜„í™© í˜ì´ì§€ -->
  <div id="processView" class="fade-in">
    <!-- í—¤ë” -->
    <div class="bg-white border-b border-slate-200 px-6 py-4">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-gradient-to-br from-navy-500 to-navy-600 rounded-xl flex items-center justify-center shadow-lg">
          <span class="text-white text-lg">ğŸ“‹</span>
        </div>
        <div class="flex-1">
          <h1 class="text-lg font-bold text-slate-800">í”„ë¡œì„¸ìŠ¤ ì§„í–‰ í˜„í™©</h1>
          <p class="text-sm text-slate-500">ì•Œë¦¬ë°”ë°”ë‹·ì»´ ì…ì ì„ ìœ„í•œ í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬</p>
        </div>
        <div class="flex items-center gap-3 text-xs">
          <div class="flex items-center gap-1.5"><span class="w-2.5 h-2.5 bg-emerald-500 rounded-full"></span><span class="text-slate-500">ì™„ë£Œ</span></div>
          <div class="flex items-center gap-1.5"><span class="w-2.5 h-2.5 bg-blue-500 rounded-full"></span><span class="text-slate-500">ì§„í–‰</span></div>
          <div class="flex items-center gap-1.5"><span class="w-2.5 h-2.5 bg-yellow-500 rounded-full"></span><span class="text-slate-500">ìš”ì²­</span></div>
          <div class="flex items-center gap-1.5"><span class="w-2.5 h-2.5 bg-slate-300 rounded-full"></span><span class="text-slate-500">ëŒ€ê¸°</span></div>
          <div class="flex items-center gap-1.5"><span class="w-2.5 h-2.5 bg-orange-500 rounded-full"></span><span class="text-slate-500">ë³´ë¥˜</span></div>
        </div>
      </div>
    </div>

    <!-- í•„í„° ì˜ì—­ -->
    <div class="bg-white px-6 py-3 flex items-center justify-between border-b border-slate-100">
      <div class="flex items-center gap-2">
        <!-- í”„ë¡œì íŠ¸ ì„ íƒ ë“œë¡­ë‹¤ìš´ -->
        <select id="projectSelect" onchange="selectProject(this.value)" class="text-sm border border-slate-200 rounded-lg px-3 py-1.5 text-slate-700 bg-white min-w-[160px]">
          <option value="all">ì „ì²´ ì—…ë¬´</option>
          <option value="alibaba" selected>ì•Œë¦¬ë°”ë°” ì…ì </option>
          <option value="extra1">ì¶”ê°€ì—…ë¬´ 1</option>
          <option value="extra2">ì¶”ê°€ì—…ë¬´ 2</option>
          <option value="extra3">ì¶”ê°€ì—…ë¬´ 3</option>
        </select>
        
        <!-- í•„í„° ë²„íŠ¼ + ë“œë¡­ë‹¤ìš´ -->
        <div class="relative">
          <button id="filterBtn" onclick="toggleFilterDropdown()" class="flex items-center gap-1.5 px-3 py-1.5 text-sm text-slate-600 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/></svg>
            <span>í•„í„°</span>
            <span id="filterBadge" class="hidden px-1.5 py-0.5 bg-blue-500 text-white text-xs rounded-full min-w-[18px] text-center">1</span>
          </button>
          
          <!-- í•„í„° ë“œë¡­ë‹¤ìš´ -->
          <div id="filterDropdown" class="filter-dropdown">
            <div class="px-4 py-3 bg-slate-50 border-b border-slate-100">
              <span class="text-xs font-semibold text-slate-500 uppercase tracking-wide">ìƒíƒœë³„ í•„í„°</span>
            </div>
            
            <div class="filter-item active" data-filter="all" onclick="selectFilter('all')">
              <span class="check-box">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>
              </span>
              <span class="filter-label">ì „ì²´ ì—…ë¬´</span>
              <span class="filter-count" id="count-all">0</span>
            </div>
            
            <div class="filter-item" data-filter="mine" onclick="selectFilter('mine')">
              <span class="check-box">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>
              </span>
              <span class="filter-label">ë‚´ ì—…ë¬´</span>
              <span class="filter-count" id="count-mine">0</span>
            </div>
            
            <div class="filter-item" data-filter="completed" onclick="selectFilter('completed')">
              <span class="check-box">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>
              </span>
              <span class="filter-label">ì™„ë£Œëœ ì—…ë¬´</span>
              <span class="filter-count" id="count-completed">0</span>
            </div>
            
            <div class="filter-item" data-filter="progress" onclick="selectFilter('progress')">
              <span class="check-box">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>
              </span>
              <span class="filter-label">ì§„í–‰ ì¤‘ ì—…ë¬´</span>
              <span class="filter-count" id="count-progress">0</span>
            </div>
            
            <div class="filter-item" data-filter="scheduled" onclick="selectFilter('scheduled')">
              <span class="check-box">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>
              </span>
              <span class="filter-label">ì˜ˆì • ì—…ë¬´</span>
              <span class="filter-count" id="count-scheduled">0</span>
            </div>
            
            <div class="filter-item" data-filter="hold" onclick="selectFilter('hold')">
              <span class="check-box">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>
              </span>
              <span class="filter-label">ë³´ë¥˜ ì—…ë¬´</span>
              <span class="filter-count" id="count-hold">0</span>
            </div>
            
            <div class="px-4 py-3 bg-slate-50 border-t border-slate-100">
              <button onclick="clearFilters()" class="w-full text-sm text-slate-500 hover:text-slate-700 transition-colors">í•„í„° ì´ˆê¸°í™”</button>
            </div>
          </div>
        </div>
        
        <!-- í˜„ì¬ í•„í„° íƒœê·¸ -->
        <div id="activeFilterTag" class="hidden flex items-center gap-1.5 px-3 py-1 bg-blue-50 text-blue-600 rounded-lg text-sm border border-blue-200">
          <span id="activeFilterText">ì „ì²´</span>
          <button onclick="clearFilters()" class="hover:bg-blue-100 rounded p-0.5 transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
          </button>
        </div>
      </div>
      
      <div class="flex items-center gap-3">
        <span class="text-sm text-slate-500">ì´ <strong id="total-count" class="text-slate-700">0</strong>ê±´</span>
        <button class="flex items-center gap-1.5 px-4 py-1.5 bg-navy-500 text-white rounded-lg text-sm font-medium hover:bg-navy-600 transition-colors">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
          ì—…ë¬´ ì¶”ê°€
        </button>
      </div>
    </div>

    <!-- í…Œì´ë¸” -->
    <div class="bg-white overflow-x-auto">
      <table class="w-full text-sm">
        <thead class="bg-slate-50 border-b border-slate-200">
          <tr class="text-xs text-slate-500 font-medium">
            <th class="text-left py-3 px-4 w-[380px]">ì—…ë¬´ëª…</th>
            <th class="text-left py-3 px-3 w-[80px]">ìƒíƒœ</th>
            <th class="text-left py-3 px-3 w-[90px]">ë‹´ë‹¹ì</th>
            <th class="text-left py-3 px-3 w-[90px]">ì‹œì‘ì¼</th>
            <th class="text-left py-3 px-3 w-[90px]">ë§ˆê°ì¼</th>
            <th class="text-left py-3 px-3 w-[70px]">ì§„ì²™ë„</th>
            <th class="text-left py-3 px-3 w-[60px]">ë²ˆí˜¸</th>
          </tr>
        </thead>
        <tbody id="task-body"></tbody>
      </table>
    </div>

    <!-- ê·¸ë£¹ ì¶”ê°€ ë²„íŠ¼ -->
    <div class="bg-white px-4 py-3 border-t border-slate-100">
      <button onclick="addGroup()" class="text-sm text-slate-500 hover:text-slate-700 border border-dashed border-slate-300 rounded-lg px-3 py-1.5 hover:bg-slate-50 transition-colors">+ ê·¸ë£¹ ì¶”ê°€</button>
    </div>
  </div>

  <!-- ì˜¤ë¥¸ìª½ ìƒì„¸ íŒ¨ë„ -->
  <div id="side-panel" class="side-panel fixed top-0 right-0 w-[460px] h-full bg-white border-l border-slate-200 shadow-2xl z-50 flex flex-col">
    <div class="flex items-center justify-between px-5 py-4 border-b border-slate-200 bg-slate-50">
      <div class="flex items-center gap-2">
        <span class="text-navy-500">ğŸ“‹</span>
        <span class="text-sm font-medium text-slate-700">ì—…ë¬´ ìƒì„¸</span>
      </div>
      <button onclick="closePanel()" class="p-1.5 hover:bg-slate-200 rounded-lg transition-colors">
        <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>
    
    <div class="flex-1 overflow-y-auto">
      <div class="flex items-center justify-between px-5 py-3 border-b border-slate-100">
        <div class="flex items-center gap-3">
          <div class="w-9 h-9 bg-gradient-to-br from-navy-400 to-navy-600 rounded-full flex items-center justify-center text-white text-xs font-bold">PM</div>
          <div>
            <span class="text-sm font-medium text-slate-800" id="panel-author">ìš´ì˜ë§¤ë‹ˆì €</span>
            <span class="text-xs text-slate-400 ml-2" id="panel-date">2025-03-01</span>
          </div>
        </div>
      </div>
      
      <div class="px-5 py-4 border-b border-slate-100">
        <h2 class="text-lg font-bold text-slate-800" id="panel-title">ì—…ë¬´ ì œëª©</h2>
        <span class="text-xs text-slate-400" id="panel-num">ì—…ë¬´ë²ˆí˜¸ 1</span>
      </div>
      
      <div class="px-5 py-4 space-y-4 border-b border-slate-100">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-xs text-slate-400 block mb-1">ìƒíƒœ</label>
            <select id="panel-status" onchange="updateTaskStatus(this.value)" class="w-full text-sm border border-slate-200 rounded-lg px-3 py-2 bg-white cursor-pointer hover:border-slate-300 transition-colors">
              <option value="completed">âœ… ì™„ë£Œ</option>
              <option value="progress">ğŸ”µ ì§„í–‰</option>
              <option value="request">ğŸŸ¡ ìš”ì²­</option>
              <option value="scheduled">â¬œ ëŒ€ê¸°</option>
              <option value="hold">ğŸŸ  ë³´ë¥˜</option>
            </select>
          </div>
          <div>
            <label class="text-xs text-slate-400 block mb-1">ë‹´ë‹¹ì</label>
            <select id="panel-who" onchange="updateTaskWho(this.value)" class="w-full text-sm border border-slate-200 rounded-lg px-3 py-2 bg-white cursor-pointer hover:border-slate-300 transition-colors">
              <option value="ìš´ì˜ë§¤ë‹ˆì €">ìš´ì˜ë§¤ë‹ˆì €</option>
              <option value="ë‹´ë‹¹ë§¤ë‹ˆì €">ë‹´ë‹¹ë§¤ë‹ˆì €</option>
              <option value="ëŒ€í–‰ì‚¬">ëŒ€í–‰ì‚¬</option>
              <option value="ê³ ê°ì‚¬">ê³ ê°ì‚¬</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-xs text-slate-400 block mb-1">ì‹œì‘ì¼</label>
            <input type="date" id="panel-start" onchange="updateTaskDate('start', this.value)" class="w-full text-sm border border-slate-200 rounded-lg px-3 py-2 bg-white cursor-pointer hover:border-slate-300 transition-colors">
          </div>
          <div>
            <label class="text-xs text-slate-400 block mb-1">ë§ˆê°ì¼</label>
            <input type="date" id="panel-end" onchange="updateTaskDate('end', this.value)" class="w-full text-sm border border-slate-200 rounded-lg px-3 py-2 bg-white cursor-pointer hover:border-slate-300 transition-colors">
          </div>
        </div>
      </div>
      
      <div class="px-5 py-4 border-b border-slate-100">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-sm font-semibold text-slate-700">í•˜ìœ„ì—…ë¬´ <span class="text-slate-400 font-normal" id="panel-subtask-count">0</span></h3>
          <button class="text-xs text-navy-500 hover:underline">+ ì¶”ê°€</button>
        </div>
        <div id="panel-subtasks" class="space-y-2">
          <p class="text-sm text-slate-400 text-center py-4">í•˜ìœ„ì—…ë¬´ê°€ ì—†ìŠµë‹ˆë‹¤</p>
        </div>
      </div>
      
      <!-- ë©”ëª¨ ì„¹ì…˜ -->
      <div class="px-5 py-4">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-sm font-semibold text-slate-700 flex items-center gap-2">
            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
            </svg>
            ë©”ëª¨
          </h3>
          <button onclick="toggleMemoEdit()" id="memo-edit-btn" class="text-xs text-navy-500 hover:underline">í¸ì§‘</button>
        </div>
        <div id="memo-display" class="bg-slate-50 rounded-lg p-3 min-h-[80px]">
          <p id="memo-text" class="text-sm text-slate-600 whitespace-pre-wrap">ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
        <div id="memo-editor" class="hidden">
          <textarea id="memo-input" class="w-full text-sm border border-slate-200 rounded-lg p-3 min-h-[100px] resize-none focus:outline-none focus:ring-2 focus:ring-navy-500/20 focus:border-navy-400" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
          <div class="flex justify-end gap-2 mt-2">
            <button onclick="cancelMemoEdit()" class="px-3 py-1.5 text-sm text-slate-600 border border-slate-200 rounded-lg hover:bg-slate-50">ì·¨ì†Œ</button>
            <button onclick="saveMemo()" class="px-3 py-1.5 text-sm text-white bg-navy-500 rounded-lg hover:bg-navy-600">ì €ì¥</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="panel-overlay" class="hidden fixed inset-0 bg-black/20 z-40" onclick="closePanel()"></div>

  <script>
    // ìƒíƒœ ì„¤ì •
    const statusConfig = {
      completed: { label: 'ì™„ë£Œ', bg: 'bg-emerald-100', text: 'text-emerald-700', dot: 'bg-emerald-500' },
      progress: { label: 'ì§„í–‰', bg: 'bg-blue-100', text: 'text-blue-700', dot: 'bg-blue-500' },
      request: { label: 'ìš”ì²­', bg: 'bg-yellow-100', text: 'text-yellow-700', dot: 'bg-yellow-500' },
      scheduled: { label: 'ëŒ€ê¸°', bg: 'bg-slate-100', text: 'text-slate-600', dot: 'bg-slate-300' },
      hold: { label: 'ë³´ë¥˜', bg: 'bg-orange-100', text: 'text-orange-700', dot: 'bg-orange-500' }
    };

    // í”„ë¡œì íŠ¸ë³„ ë°ì´í„°
    const projectsData = {
      // ì•Œë¦¬ë°”ë°” ì…ì  í”„ë¡œì íŠ¸
      alibaba: [
        {
          id: 'g1', name: '1. ìë£Œ ì·¨í•©', expanded: false,
          tasks: [
            { id: 1, name: 'ğŸ“ ê¸°ë³¸ ì…‹íŒ… ì§„í–‰í•˜ê¸°', status: 'progress', who: 'ìš´ì˜ë§¤ë‹ˆì €', start: '2025-03-01', end: '2025-03-15', progress: 50, num: 1, memo: '3ì›” 10ì¼ê¹Œì§€ HSì½”ë“œ í™•ì • í•„ìš”\në‹´ë‹¹ì í™•ì¸ ìš”ì²­í•¨',
              children: [
                { id: 101, name: 'ê´€ì„¸/í†µê´€ HSì½”ë“œ í™•ì¸', status: 'completed', who: 'ìš´ì˜ë§¤ë‹ˆì €', start: '2025-03-01', end: '2025-03-05', progress: 100, num: 2 },
                { id: 102, name: 'ë‹¨ê°€ì…‹íŒ… - ë°°ì†¡ë¦¬ë“œíƒ€ì„', status: 'progress', who: 'ìš´ì˜ë§¤ë‹ˆì €', start: '2025-03-05', end: '2025-03-15', progress: 30, num: 3, memo: 'í•´ì™¸ë°°ì†¡ ë¦¬ë“œíƒ€ì„ í™•ì¸ ì¤‘\n- í•­ê³µ: 5-7ì¼\n- í•´ìƒ: 20-25ì¼' },
                { id: 103, name: 'ë‹¨ê°€ì…‹íŒ… - ìš©ê¸°', status: 'progress', who: 'ìš´ì˜ë§¤ë‹ˆì €', start: '2025-03-05', end: '2025-03-15', progress: 20, num: 4 },
                { id: 104, name: 'ë‹¨ê°€ì…‹íŒ… - ì¶©ì§„', status: 'scheduled', who: 'ìš´ì˜ë§¤ë‹ˆì €', start: '-', end: '-', progress: 0, num: 5 }
              ]
            },
            { id: 2, name: 'ğŸ“‚ ìë£Œìˆ˜ì§‘ ì™„ë£Œí•˜ê¸°', status: 'progress', who: 'ìš´ì˜ë§¤ë‹ˆì €', start: '2025-03-01', end: '2025-03-12', progress: 70, num: 6,
              children: [
                { id: 201, name: '[í•„ìˆ˜] 1_ ë¡œê³ ì´ë¯¸ì§€', status: 'completed', who: 'ìš´ì˜ë§¤ë‹ˆì €', start: '2025-03-01', end: '2025-03-05', progress: 100, num: 7 },
                { id: 202, name: '[í•„ìˆ˜] 2_ ë””ìì¸í…œí”Œë¦¿', status: 'completed', who: 'ìš´ì˜ë§¤ë‹ˆì €', start: '2025-03-01', end: '2025-03-05', progress: 100, num: 8 },
                { id: 203, name: '[í•„ìˆ˜] 9_ ì œí’ˆ ì´ë¯¸ì§€', status: 'progress', who: 'ìš´ì˜ë§¤ë‹ˆì €', start: '2025-03-05', end: '2025-03-15', progress: 50, num: 9 },
                { id: 204, name: 'â˜… ì œí’ˆ ì¸ì¦ì„œ (ë¯¸ë¦¬ì¤€ë¹„)', status: 'request', who: 'ê³ ê°ì‚¬', start: '-', end: '-', progress: 0, num: 10 }
              ]
            }
          ]
        },
        {
          id: 'g2', name: '2. ìë£Œ ê²€í† ', expanded: false,
          tasks: [
            { id: 3, name: 'ğŸ“‹ ì œì¶œë¬¼ ê²€í† ', status: 'completed', who: 'ë‹´ë‹¹ë§¤ë‹ˆì €', start: '2025-03-08', end: '2025-03-10', progress: 100, num: 11 },
            { id: 4, name: 'ğŸ“ ë³´ì™„ ìš”ì²­', status: 'completed', who: 'ë‹´ë‹¹ë§¤ë‹ˆì €', start: '2025-03-08', end: '2025-03-10', progress: 100, num: 12 }
          ]
        },
        {
          id: 'g3', name: '3. ë‹¨í†¡ë°© ì´ˆëŒ€', expanded: false,
          tasks: [
            { id: 5, name: 'ğŸ’¬ KSP ìˆ˜í–‰ì‚¬ ë‹¨í†¡ë°© ì´ˆëŒ€', status: 'completed', who: 'ë‹´ë‹¹ë§¤ë‹ˆì €', start: '2025-03-10', end: '2025-03-10', progress: 100, num: 13 }
          ]
        },
        {
          id: 'g4', name: '4. BV ì¸ì¦', expanded: false,
          tasks: [
            { id: 6, name: 'âœ… BV ì¸ì¦ ì‹ ì²­', status: 'completed', who: 'ë‹´ë‹¹ë§¤ë‹ˆì €', start: '2025-03-11', end: '2025-03-11', progress: 100, num: 14 },
            { id: 7, name: 'âœ… BV ì¸ì¦ ìŠ¹ì¸ í™•ì¸', status: 'completed', who: 'ë‹´ë‹¹ë§¤ë‹ˆì €', start: '2025-03-11', end: '2025-03-14', progress: 100, num: 15 }
          ]
        },
        {
          id: 'g5', name: '5. ì ‘ê·¼ê¶Œí•œ ì‹ ì²­', expanded: false,
          tasks: [
            { id: 8, name: 'ğŸ”— APPLY ë§í¬ ì „ë‹¬', status: 'completed', who: 'ëŒ€í–‰ì‚¬', start: '2025-03-15', end: '2025-03-15', progress: 100, num: 16 },
            { id: 9, name: 'ğŸ”‘ APPLY ì‹ ì²­ (ê³ ê°ì‚¬ ê³„ì •)', status: 'progress', who: 'ê³ ê°ì‚¬', start: '2025-03-15', end: '2025-03-20', progress: 50, num: 17 }
          ]
        },
        {
          id: 'g6', name: '6. ì‹œì•ˆ ì œì‘', expanded: false,
          tasks: [
            { id: 10, name: 'ğŸ¨ ì‹œì•ˆ ì œì‘', status: 'progress', who: 'ëŒ€í–‰ì‚¬', start: '2025-03-20', end: '2025-03-25', progress: 30, num: 18 },
            { id: 11, name: 'ğŸ“ ìƒ˜í”Œ í¬ìŠ¤íŒ… 5ê°œ', status: 'scheduled', who: 'ëŒ€í–‰ì‚¬', start: '-', end: '-', progress: 0, num: 19 }
          ]
        },
        {
          id: 'g7', name: '7. ì‹œì•ˆ ê²€ìˆ˜', expanded: false,
          tasks: [
            { id: 12, name: 'ğŸ” ì‹œì•ˆ ê²€ìˆ˜', status: 'scheduled', who: 'ìš´ì˜ë§¤ë‹ˆì €', start: '-', end: '-', progress: 0, num: 20 },
            { id: 13, name: 'ğŸ” ìƒ˜í”Œ í¬ìŠ¤íŒ… ê²€ìˆ˜', status: 'scheduled', who: 'ìš´ì˜ë§¤ë‹ˆì €', start: '-', end: '-', progress: 0, num: 21 }
          ]
        },
        {
          id: 'g8', name: '8. ìƒµ ì„¸íŒ…', expanded: false,
          tasks: [
            { id: 14, name: 'ğŸª ë¯¸ë‹ˆì‚¬ì´íŠ¸ ì„¸íŒ…', status: 'scheduled', who: 'ëŒ€í–‰ì‚¬', start: '-', end: '-', progress: 0, num: 22 },
            { id: 15, name: 'ğŸ–¼ï¸ ë¡œê³ /íšŒì‚¬í”„ë¡œí•„ ì„¤ì •', status: 'scheduled', who: 'ëŒ€í–‰ì‚¬', start: '-', end: '-', progress: 0, num: 23 }
          ]
        },
        {
          id: 'g9', name: '9. ì œí’ˆ ì—…ë¡œë“œ', expanded: false,
          tasks: [
            { id: 16, name: 'ğŸ“¤ ìƒì„¸í˜ì´ì§€ í¼ ì œì‘', status: 'progress', who: 'ìš´ì˜ë§¤ë‹ˆì €', start: '2025-03-20', end: '2025-04-05', progress: 20, num: 24 },
            { id: 17, name: 'ğŸ–¼ï¸ ì¸ë„¤ì¼ í¼ ì œì‘', status: 'scheduled', who: 'ìš´ì˜ë§¤ë‹ˆì €', start: '-', end: '-', progress: 0, num: 25 }
          ]
        },
        {
          id: 'g10', name: '10. ìƒµ ìš´ì˜', expanded: false,
          tasks: [
            { id: 18, name: 'ğŸ”” RFQ ì•Œë¦¼ ì„¤ì •', status: 'scheduled', who: 'ëŒ€í–‰ì‚¬', start: '-', end: '-', progress: 0, num: 26 },
            { id: 19, name: 'ğŸ”¥ Warm leads ì œê³µ', status: 'scheduled', who: 'ëŒ€í–‰ì‚¬', start: '-', end: '-', progress: 0, num: 27 }
          ]
        },
        {
          id: 'g11', name: 'ì¶”ê°€ ì—…ë¬´', expanded: false,
          tasks: [
            { id: 20, name: 'ğŸ“Œ ì¶”ê°€ì—…ë¬´ 1', status: 'progress', who: 'ìš´ì˜ë§¤ë‹ˆì €', start: '2025-03-25', end: '2025-04-01', progress: 40, num: 28 },
            { id: 21, name: 'ğŸ“Œ ì¶”ê°€ì—…ë¬´ 2', status: 'scheduled', who: 'ë‹´ë‹¹ë§¤ë‹ˆì €', start: '-', end: '-', progress: 0, num: 29 },
            { id: 22, name: 'ğŸ“Œ ì¶”ê°€ì—…ë¬´ 3', status: 'hold', who: 'ê³ ê°ì‚¬', start: '2025-03-20', end: '2025-04-10', progress: 10, num: 30 }
          ]
        }
      ],
      
      // ì¶”ê°€ì—…ë¬´ 1 í”„ë¡œì íŠ¸
      extra1: [
        {
          id: 'e1g1', name: '1. ê¸°íš ë‹¨ê³„', expanded: false,
          tasks: [
            { id: 1001, name: 'ğŸ“‹ ìš”êµ¬ì‚¬í•­ ë¶„ì„', status: 'completed', who: 'ìš´ì˜ë§¤ë‹ˆì €', start: '2025-04-01', end: '2025-04-05', progress: 100, num: 1 },
            { id: 1002, name: 'ğŸ“ ê¸°íšì„œ ì‘ì„±', status: 'progress', who: 'ìš´ì˜ë§¤ë‹ˆì €', start: '2025-04-05', end: '2025-04-15', progress: 60, num: 2 }
          ]
        },
        {
          id: 'e1g2', name: '2. ì‹¤í–‰ ë‹¨ê³„', expanded: false,
          tasks: [
            { id: 1003, name: 'ğŸ”§ ê°œë°œ ì§„í–‰', status: 'scheduled', who: 'ëŒ€í–‰ì‚¬', start: '-', end: '-', progress: 0, num: 3 },
            { id: 1004, name: 'âœ… í…ŒìŠ¤íŠ¸', status: 'scheduled', who: 'ë‹´ë‹¹ë§¤ë‹ˆì €', start: '-', end: '-', progress: 0, num: 4 }
          ]
        }
      ],
      
      // ì¶”ê°€ì—…ë¬´ 2 í”„ë¡œì íŠ¸
      extra2: [
        {
          id: 'e2g1', name: '1. ì¤€ë¹„ ë‹¨ê³„', expanded: false,
          tasks: [
            { id: 2001, name: 'ğŸ“ ìë£Œ ìˆ˜ì§‘', status: 'progress', who: 'ë‹´ë‹¹ë§¤ë‹ˆì €', start: '2025-04-10', end: '2025-04-20', progress: 30, num: 1 },
            { id: 2002, name: 'ğŸ“Š ë¶„ì„ ì‘ì—…', status: 'scheduled', who: 'ìš´ì˜ë§¤ë‹ˆì €', start: '-', end: '-', progress: 0, num: 2 }
          ]
        },
        {
          id: 'e2g2', name: '2. ì§„í–‰ ë‹¨ê³„', expanded: false,
          tasks: [
            { id: 2003, name: 'ğŸ¯ ëª©í‘œ ì„¤ì •', status: 'scheduled', who: 'ìš´ì˜ë§¤ë‹ˆì €', start: '-', end: '-', progress: 0, num: 3 },
            { id: 2004, name: 'ğŸ“ˆ ì‹¤í–‰', status: 'scheduled', who: 'ëŒ€í–‰ì‚¬', start: '-', end: '-', progress: 0, num: 4 }
          ]
        }
      ],
      
      // ì¶”ê°€ì—…ë¬´ 3 í”„ë¡œì íŠ¸
      extra3: [
        {
          id: 'e3g1', name: '1. ê²€í†  ë‹¨ê³„', expanded: false,
          tasks: [
            { id: 3001, name: 'ğŸ” í˜„í™© íŒŒì•…', status: 'hold', who: 'ìš´ì˜ë§¤ë‹ˆì €', start: '2025-04-15', end: '2025-05-01', progress: 10, num: 1 },
            { id: 3002, name: 'ğŸ“ ë³´ê³ ì„œ ì‘ì„±', status: 'scheduled', who: 'ë‹´ë‹¹ë§¤ë‹ˆì €', start: '-', end: '-', progress: 0, num: 2 }
          ]
        }
      ]
    };

    // í˜„ì¬ ì„ íƒëœ í”„ë¡œì íŠ¸
    let currentProject = 'alibaba';
    let groups = [...projectsData.alibaba];

    const expandedTasks = new Set();
    let currentTask = null;
    let currentFilter = 'all';

    // í”„ë¡œì íŠ¸ ì„ íƒ
    function selectProject(projectId) {
      currentProject = projectId;
      
      if (projectId === 'all') {
        // ì „ì²´ í”„ë¡œì íŠ¸ ë³‘í•©
        groups = [];
        Object.keys(projectsData).forEach(key => {
          projectsData[key].forEach(group => {
            groups.push({...group, projectKey: key});
          });
        });
      } else {
        groups = projectsData[projectId] ? [...projectsData[projectId]] : [];
      }
      
      // í—¤ë” ì—…ë°ì´íŠ¸
      updateHeader(projectId);
      
      // ë‹¤ì‹œ ë Œë”ë§
      expandedTasks.clear();
      renderTasks();
      updateFilterCounts();
    }

    // ê·¸ë£¹ì˜ ì¢…í•© ìƒíƒœ ê³„ì‚°
    function getGroupStatus(group) {
      const allTasks = [];
      
      // ê·¸ë£¹ ë‚´ ëª¨ë“  ì—…ë¬´ì™€ í•˜ìœ„ì—…ë¬´ ìˆ˜ì§‘
      group.tasks.forEach(task => {
        allTasks.push(task);
        if (task.children) {
          task.children.forEach(child => allTasks.push(child));
        }
      });
      
      if (allTasks.length === 0) return 'scheduled';
      
      // ìƒíƒœë³„ ì¹´ìš´íŠ¸
      const statuses = allTasks.map(t => t.status);
      const hasProgress = statuses.some(s => s === 'progress');
      const hasRequest = statuses.some(s => s === 'request');
      const hasHold = statuses.some(s => s === 'hold');
      const allCompleted = statuses.every(s => s === 'completed');
      const allScheduled = statuses.every(s => s === 'scheduled');
      
      // ìš°ì„ ìˆœìœ„: ì§„í–‰ > ìš”ì²­ > ë³´ë¥˜ > ì™„ë£Œ > ì˜ˆì •
      if (allCompleted) return 'completed';
      if (allScheduled) return 'scheduled';
      if (hasProgress) return 'progress';
      if (hasRequest) return 'request';
      if (hasHold) return 'hold';
      
      // ì¼ë¶€ ì™„ë£Œ, ì¼ë¶€ ì˜ˆì •ì¸ ê²½ìš° â†’ ì§„í–‰ìœ¼ë¡œ í‘œì‹œ
      return 'progress';
    }

    // í—¤ë” ì—…ë°ì´íŠ¸
    function updateHeader(projectId) {
      const titles = {
        all: { title: 'ì „ì²´ í”„ë¡œì íŠ¸', desc: 'ëª¨ë“  í”„ë¡œì íŠ¸ì˜ ì—…ë¬´ë¥¼ í™•ì¸í•©ë‹ˆë‹¤' },
        alibaba: { title: 'í”„ë¡œì„¸ìŠ¤ ì§„í–‰ í˜„í™©', desc: 'ì•Œë¦¬ë°”ë°”ë‹·ì»´ ì…ì ì„ ìœ„í•œ í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬' },
        extra1: { title: 'ì¶”ê°€ì—…ë¬´ 1', desc: 'ì¶”ê°€ì—…ë¬´ 1 í”„ë¡œì íŠ¸ ê´€ë¦¬' },
        extra2: { title: 'ì¶”ê°€ì—…ë¬´ 2', desc: 'ì¶”ê°€ì—…ë¬´ 2 í”„ë¡œì íŠ¸ ê´€ë¦¬' },
        extra3: { title: 'ì¶”ê°€ì—…ë¬´ 3', desc: 'ì¶”ê°€ì—…ë¬´ 3 í”„ë¡œì íŠ¸ ê´€ë¦¬' }
      };
      
      const info = titles[projectId] || titles.alibaba;
      document.querySelector('#processView h1').textContent = info.title;
      document.querySelector('#processView h1 + p').textContent = info.desc;
    }

    // í•„í„° ë“œë¡­ë‹¤ìš´ í† ê¸€
    function toggleFilterDropdown() {
      const dropdown = document.getElementById('filterDropdown');
      dropdown.classList.toggle('show');
      
      if (dropdown.classList.contains('show')) {
        updateFilterCounts();
        setTimeout(() => {
          document.addEventListener('click', closeFilterOnOutsideClick);
        }, 10);
      }
    }

    function closeFilterOnOutsideClick(e) {
      const dropdown = document.getElementById('filterDropdown');
      const filterBtn = document.getElementById('filterBtn');
      if (!dropdown.contains(e.target) && !filterBtn.contains(e.target)) {
        dropdown.classList.remove('show');
        document.removeEventListener('click', closeFilterOnOutsideClick);
      }
    }

    // í•„í„°ë³„ ì—…ë¬´ ìˆ˜ ê³„ì‚°
    function updateFilterCounts() {
      let counts = { all: 0, mine: 0, completed: 0, progress: 0, scheduled: 0, hold: 0 };
      
      groups.forEach(group => {
        group.tasks.forEach(task => {
          counts.all++;
          if (task.who === 'ìš´ì˜ë§¤ë‹ˆì €') counts.mine++;
          if (task.status === 'completed') counts.completed++;
          if (task.status === 'progress') counts.progress++;
          if (task.status === 'scheduled') counts.scheduled++;
          if (task.status === 'hold') counts.hold++;
          
          if (task.children) {
            task.children.forEach(child => {
              counts.all++;
              if (child.who === 'ìš´ì˜ë§¤ë‹ˆì €') counts.mine++;
              if (child.status === 'completed') counts.completed++;
              if (child.status === 'progress') counts.progress++;
              if (child.status === 'scheduled') counts.scheduled++;
              if (child.status === 'hold') counts.hold++;
            });
          }
        });
      });
      
      document.getElementById('count-all').textContent = counts.all;
      document.getElementById('count-mine').textContent = counts.mine;
      document.getElementById('count-completed').textContent = counts.completed;
      document.getElementById('count-progress').textContent = counts.progress;
      document.getElementById('count-scheduled').textContent = counts.scheduled;
      document.getElementById('count-hold').textContent = counts.hold;
    }

    // í•„í„° ì„ íƒ
    function selectFilter(filter) {
      currentFilter = filter;
      
      // UI ì—…ë°ì´íŠ¸
      document.querySelectorAll('.filter-item').forEach(item => {
        item.classList.remove('active');
        if (item.dataset.filter === filter) {
          item.classList.add('active');
        }
      });
      
      // í•„í„° íƒœê·¸ ì—…ë°ì´íŠ¸
      const filterTag = document.getElementById('activeFilterTag');
      const filterText = document.getElementById('activeFilterText');
      const filterBadge = document.getElementById('filterBadge');
      
      if (filter !== 'all') {
        filterTag.classList.remove('hidden');
        const filterNames = {
          mine: 'ë‚´ ì—…ë¬´',
          completed: 'ì™„ë£Œëœ ì—…ë¬´',
          progress: 'ì§„í–‰ ì¤‘ ì—…ë¬´',
          scheduled: 'ì˜ˆì • ì—…ë¬´',
          hold: 'ë³´ë¥˜ ì—…ë¬´'
        };
        filterText.textContent = filterNames[filter];
        filterBadge.classList.remove('hidden');
      } else {
        filterTag.classList.add('hidden');
        filterBadge.classList.add('hidden');
      }
      
      // ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
      document.getElementById('filterDropdown').classList.remove('show');
      document.removeEventListener('click', closeFilterOnOutsideClick);
      
      // í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§
      renderTasks();
    }

    // í•„í„° ì´ˆê¸°í™”
    function clearFilters() {
      selectFilter('all');
    }

    // ì—…ë¬´ í•„í„°ë§
    function filterTask(task) {
      if (currentFilter === 'all') return true;
      if (currentFilter === 'mine') return task.who === 'ìš´ì˜ë§¤ë‹ˆì €';
      if (currentFilter === 'completed') return task.status === 'completed';
      if (currentFilter === 'progress') return task.status === 'progress';
      if (currentFilter === 'scheduled') return task.status === 'scheduled';
      if (currentFilter === 'hold') return task.status === 'hold';
      return true;
    }

    // ê·¸ë£¹ì— í•„í„°ë§ëœ ì—…ë¬´ê°€ ìˆëŠ”ì§€ í™•ì¸
    function hasFilteredTasks(group) {
      // ë¹ˆ ê·¸ë£¹ë„ í‘œì‹œ (ì „ì²´ í•„í„°ì¼ ë•Œ)
      if (currentFilter === 'all') return true;
      
      // ì—…ë¬´ê°€ ì—†ëŠ” ê·¸ë£¹ì€ ì „ì²´ í•„í„°ì¼ ë•Œë§Œ í‘œì‹œ
      if (group.tasks.length === 0) return false;
      
      return group.tasks.some(task => {
        if (filterTask(task)) return true;
        if (task.children) {
          return task.children.some(child => filterTask(child));
        }
        return false;
      });
    }

    function countFilteredTasks() {
      let count = 0;
      groups.forEach(g => {
        g.tasks.forEach(t => {
          if (filterTask(t)) count++;
          if (t.children) {
            t.children.forEach(c => {
              if (filterTask(c)) count++;
            });
          }
        });
      });
      return count;
    }

    function findTaskById(id) {
      // í˜„ì¬ ì„ íƒëœ í”„ë¡œì íŠ¸ì˜ groupsì—ì„œ ê²€ìƒ‰
      for (const group of groups) {
        for (const task of group.tasks) {
          if (task.id === id) return task;
          if (task.children) {
            const child = task.children.find(c => c.id === id);
            if (child) return child;
          }
        }
      }
      // ì „ì²´ í”„ë¡œì íŠ¸ì—ì„œ ê²€ìƒ‰ (ì „ì²´ ì—…ë¬´ ì„ íƒ ì‹œ)
      if (currentProject === 'all') {
        for (const projectKey of Object.keys(projectsData)) {
          for (const group of projectsData[projectKey]) {
            for (const task of group.tasks) {
              if (task.id === id) return task;
              if (task.children) {
                const child = task.children.find(c => c.id === id);
                if (child) return child;
              }
            }
          }
        }
      }
      return null;
    }

    function openPanel(taskId) {
      const task = findTaskById(taskId);
      if (!task) return;
      
      currentTask = task;
      document.getElementById('panel-title').textContent = task.name;
      document.getElementById('panel-num').textContent = `ì—…ë¬´ë²ˆí˜¸ ${task.num}`;
      document.getElementById('panel-author').textContent = task.who || 'ìš´ì˜ë§¤ë‹ˆì €';
      document.getElementById('panel-date').textContent = task.start || '-';
      document.getElementById('panel-status').value = task.status;
      document.getElementById('panel-who').value = task.who || 'ìš´ì˜ë§¤ë‹ˆì €';
      document.getElementById('panel-start').value = task.start && task.start !== '-' ? task.start : '';
      document.getElementById('panel-end').value = task.end && task.end !== '-' ? task.end : '';
      
      const subtasksContainer = document.getElementById('panel-subtasks');
      const subtaskCount = document.getElementById('panel-subtask-count');
      
      if (task.children && task.children.length > 0) {
        subtaskCount.textContent = task.children.length;
        subtasksContainer.innerHTML = task.children.map(child => {
          const sc = statusConfig[child.status] || statusConfig.scheduled;
          return `
            <div class="flex items-center justify-between p-2.5 rounded-lg border border-slate-100 cursor-pointer hover:border-slate-200 hover:bg-slate-50 transition-colors" onclick="openPanel(${child.id})">
              <div class="flex items-center gap-2">
                <span class="status-tag ${sc.bg} ${sc.text}">â— ${sc.label}</span>
                <span class="text-sm text-slate-700">${child.name}</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="text-xs text-slate-400">${child.end || '-'}</span>
                <span class="px-2 py-0.5 bg-navy-500 text-white text-xs rounded">${(child.who || 'ë‹´ë‹¹').substring(0, 2)}</span>
              </div>
            </div>
          `;
        }).join('');
      } else {
        subtaskCount.textContent = '0';
        subtasksContainer.innerHTML = '<p class="text-sm text-slate-400 text-center py-4">í•˜ìœ„ì—…ë¬´ê°€ ì—†ìŠµë‹ˆë‹¤</p>';
      }
      
      // ë©”ëª¨ í‘œì‹œ ì—…ë°ì´íŠ¸
      updateMemoDisplay(task);
      
      document.getElementById('side-panel').classList.add('open');
      document.getElementById('panel-overlay').classList.remove('hidden');
    }

    function closePanel() {
      document.getElementById('side-panel').classList.remove('open');
      document.getElementById('panel-overlay').classList.add('hidden');
    }

    // ì—…ë¬´ ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateTaskStatus(newStatus) {
      if (!currentTask) return;
      
      // í˜„ì¬ ì—…ë¬´ì˜ ìƒíƒœ ì—…ë°ì´íŠ¸
      currentTask.status = newStatus;
      
      // ì§„ì²™ë„ë„ í•¨ê»˜ ì—…ë°ì´íŠ¸
      if (newStatus === 'completed') {
        currentTask.progress = 100;
      } else if (newStatus === 'scheduled' && currentTask.progress === 100) {
        currentTask.progress = 0;
      }
      
      // í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§
      renderTasks();
      updateFilterCounts();
      
      // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
      showToast(`ìƒíƒœê°€ "${statusConfig[newStatus].label}"(ìœ¼)ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }

    // ë‹´ë‹¹ì ì—…ë°ì´íŠ¸
    function updateTaskWho(newWho) {
      if (!currentTask) return;
      
      currentTask.who = newWho;
      
      // í—¤ë”ì˜ ë‹´ë‹¹ì ì •ë³´ë„ ì—…ë°ì´íŠ¸
      const headerWho = document.querySelector('#side-panel .text-sm.text-slate-600');
      if (headerWho) {
        const date = currentTask.start && currentTask.start !== '-' ? currentTask.start : '';
        headerWho.textContent = date ? `${newWho}  ${date}` : newWho;
      }
      
      // í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§
      renderTasks();
      updateFilterCounts();
      
      showToast(`ë‹´ë‹¹ìê°€ "${newWho}"(ìœ¼)ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }

    // ë‚ ì§œ ì—…ë°ì´íŠ¸
    function updateTaskDate(type, newDate) {
      if (!currentTask) return;
      
      if (type === 'start') {
        currentTask.start = newDate || '-';
        // í—¤ë”ì˜ ë‚ ì§œ ì •ë³´ë„ ì—…ë°ì´íŠ¸
        const headerWho = document.querySelector('#side-panel .text-sm.text-slate-600');
        if (headerWho && newDate) {
          headerWho.textContent = `${currentTask.who}  ${newDate}`;
        }
      } else if (type === 'end') {
        currentTask.end = newDate || '-';
      }
      
      // í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§
      renderTasks();
      
      const label = type === 'start' ? 'ì‹œì‘ì¼' : 'ë§ˆê°ì¼';
      showToast(`${label}ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }

    // ìƒˆ ê·¸ë£¹ ì¶”ê°€
    function addGroup() {
      // ìƒˆ ê·¸ë£¹ ID ìƒì„±
      const newGroupId = 'g_new_' + Date.now();
      const groupCount = groups.length + 1;
      
      // ìƒˆ ê·¸ë£¹ ìƒì„±
      const newGroup = {
        id: newGroupId,
        name: `ìƒˆ ê·¸ë£¹`,
        expanded: true,
        tasks: []
      };
      
      // í˜„ì¬ í”„ë¡œì íŠ¸ì˜ groupsì— ì¶”ê°€
      groups.push(newGroup);
      
      // ì›ë³¸ ë°ì´í„°ì—ë„ ì¶”ê°€ (í”„ë¡œì íŠ¸ë³„)
      if (currentProject !== 'all' && projectsData[currentProject]) {
        projectsData[currentProject].push(newGroup);
      }
      
      // ë‹¤ì‹œ ë Œë”ë§
      renderTasks();
      updateFilterCounts();
      
      // ê·¸ë£¹ëª… ì¸ë¼ì¸ í¸ì§‘ ëª¨ë“œ ì§„ì…
      setTimeout(() => {
        startEditGroupName(newGroupId);
      }, 100);
      
      showToast('ìƒˆ ê·¸ë£¹ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.');
    }

    // ê·¸ë£¹ëª… ì¸ë¼ì¸ í¸ì§‘ ì‹œì‘
    function startEditGroupName(groupId) {
      const group = groups.find(g => g.id === groupId);
      if (!group) return;
      
      const nameSpan = document.querySelector(`[data-group-id="${groupId}"]`);
      if (!nameSpan) return;
      
      const currentName = group.name;
      const rect = nameSpan.getBoundingClientRect();
      
      // inputìœ¼ë¡œ êµì²´
      const input = document.createElement('input');
      input.type = 'text';
      input.value = currentName;
      input.className = 'group-name-input font-semibold text-slate-700 bg-white border border-navy-400 rounded px-2 py-0.5 outline-none';
      input.style.width = Math.max(150, rect.width + 20) + 'px';
      
      // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
      input.onblur = () => saveGroupName(groupId, input.value);
      input.onkeydown = (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          saveGroupName(groupId, input.value);
        } else if (e.key === 'Escape') {
          renderTasks(); // ì·¨ì†Œ
        }
      };
      
      nameSpan.replaceWith(input);
      input.focus();
      input.select();
    }

    // ê·¸ë£¹ëª… ì €ì¥
    function saveGroupName(groupId, newName) {
      const group = groups.find(g => g.id === groupId);
      if (!group) return;
      
      const trimmedName = newName.trim();
      if (trimmedName) {
        group.name = trimmedName;
        
        // ì›ë³¸ ë°ì´í„°ì—ë„ ë°˜ì˜
        if (currentProject !== 'all' && projectsData[currentProject]) {
          const originalGroup = projectsData[currentProject].find(g => g.id === groupId);
          if (originalGroup) {
            originalGroup.name = trimmedName;
          }
        }
        
        showToast('ê·¸ë£¹ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
      
      renderTasks();
    }

    // ê·¸ë£¹ëª… í¸ì§‘ (ë”ë¸”í´ë¦­ìš©)
    function editGroupName(groupId) {
      startEditGroupName(groupId);
    }

    // ê·¸ë£¹ì— ì—…ë¬´ ì¶”ê°€
    function addTaskToGroup(groupId) {
      const group = groups.find(g => g.id === groupId);
      if (!group) return;
      
      const taskName = prompt('ì—…ë¬´ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:', 'ğŸ“Œ ìƒˆ ì—…ë¬´');
      if (!taskName || !taskName.trim()) return;
      
      // ìƒˆ ì—…ë¬´ ID ìƒì„±
      const newTaskId = Date.now();
      const taskNum = countAllTasks() + 1;
      
      const newTask = {
        id: newTaskId,
        name: taskName.trim(),
        status: 'scheduled',
        who: 'ìš´ì˜ë§¤ë‹ˆì €',
        start: '-',
        end: '-',
        progress: 0,
        num: taskNum
      };
      
      group.tasks.push(newTask);
      
      // ê·¸ë£¹ì´ ë‹«í˜€ìˆìœ¼ë©´ ì—´ê¸°
      group.expanded = true;
      
      renderTasks();
      updateFilterCounts();
      showToast('ìƒˆ ì—…ë¬´ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
      
      // ìƒˆ ì—…ë¬´ íŒ¨ë„ ì—´ê¸°
      openPanel(newTaskId);
    }

    // ì „ì²´ ì—…ë¬´ ìˆ˜ ê³„ì‚°
    function countAllTasks() {
      let count = 0;
      groups.forEach(group => {
        group.tasks.forEach(task => {
          count++;
          if (task.children) count += task.children.length;
        });
      });
      return count;
    }

    // í† ìŠ¤íŠ¸ ë©”ì‹œì§€
    function showToast(message) {
      // ê¸°ì¡´ í† ìŠ¤íŠ¸ ì œê±°
      const existingToast = document.querySelector('.toast-message');
      if (existingToast) existingToast.remove();
      
      const toast = document.createElement('div');
      toast.className = 'toast-message fixed bottom-6 left-1/2 -translate-x-1/2 px-4 py-2.5 bg-slate-800 text-white text-sm rounded-lg shadow-lg z-[100] animate-fade-in';
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transition = 'opacity 0.3s';
        setTimeout(() => toast.remove(), 300);
      }, 2000);
    }

    // ë©”ëª¨ í¸ì§‘ í† ê¸€
    function toggleMemoEdit() {
      const display = document.getElementById('memo-display');
      const editor = document.getElementById('memo-editor');
      const editBtn = document.getElementById('memo-edit-btn');
      const input = document.getElementById('memo-input');
      
      display.classList.add('hidden');
      editor.classList.remove('hidden');
      editBtn.classList.add('hidden');
      
      // í˜„ì¬ ë©”ëª¨ ë‚´ìš©ì„ textareaì— ì„¤ì •
      const currentMemo = currentTask?.memo || '';
      input.value = currentMemo;
      input.focus();
    }

    // ë©”ëª¨ í¸ì§‘ ì·¨ì†Œ
    function cancelMemoEdit() {
      const display = document.getElementById('memo-display');
      const editor = document.getElementById('memo-editor');
      const editBtn = document.getElementById('memo-edit-btn');
      
      display.classList.remove('hidden');
      editor.classList.add('hidden');
      editBtn.classList.remove('hidden');
    }

    // ë©”ëª¨ ì €ì¥
    function saveMemo() {
      if (!currentTask) return;
      
      const input = document.getElementById('memo-input');
      const memoText = input.value.trim();
      
      // ë°ì´í„°ì— ë©”ëª¨ ì €ì¥
      currentTask.memo = memoText;
      
      // UI ì—…ë°ì´íŠ¸
      const memoDisplay = document.getElementById('memo-text');
      memoDisplay.textContent = memoText || 'ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.';
      memoDisplay.classList.toggle('text-slate-400', !memoText);
      memoDisplay.classList.toggle('text-slate-600', !!memoText);
      
      cancelMemoEdit();
      showToast('ë©”ëª¨ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    // ë©”ëª¨ í‘œì‹œ ì—…ë°ì´íŠ¸
    function updateMemoDisplay(task) {
      const memoText = document.getElementById('memo-text');
      const memoInput = document.getElementById('memo-input');
      const display = document.getElementById('memo-display');
      const editor = document.getElementById('memo-editor');
      const editBtn = document.getElementById('memo-edit-btn');
      
      // í¸ì§‘ ëª¨ë“œ ì´ˆê¸°í™”
      display.classList.remove('hidden');
      editor.classList.add('hidden');
      editBtn.classList.remove('hidden');
      
      // ë©”ëª¨ ë‚´ìš© í‘œì‹œ
      const memo = task?.memo || '';
      memoText.textContent = memo || 'ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.';
      memoText.classList.toggle('text-slate-400', !memo);
      memoText.classList.toggle('text-slate-600', !!memo);
      memoInput.value = memo;
    }

    function toggleGroup(groupId) {
      const group = groups.find(g => g.id === groupId);
      if (group) {
        group.expanded = !group.expanded;
        renderTasks();
      }
    }

    function toggleTaskExpand(taskId) {
      if (expandedTasks.has(taskId)) {
        expandedTasks.delete(taskId);
      } else {
        expandedTasks.add(taskId);
      }
      renderTasks();
    }

    function renderTasks() {
      const tbody = document.getElementById('task-body');
      let html = '';

      groups.forEach(group => {
        if (!hasFilteredTasks(group)) return;
        
        const filteredCount = group.tasks.filter(t => filterTask(t) || (t.children && t.children.some(c => filterTask(c)))).length;
        const groupStatus = getGroupStatus(group);
        const gs = statusConfig[groupStatus] || statusConfig.scheduled;
        
        html += `
          <tr class="group-header border-b border-slate-100" onclick="toggleGroup('${group.id}')">
            <td class="py-2.5 px-4">
              <div class="flex items-center gap-2">
                <svg class="w-4 h-4 text-slate-400 expand-icon ${group.expanded ? '' : 'collapsed'}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
                <span class="font-semibold text-slate-700 group-name-text" data-group-id="${group.id}" ondblclick="event.stopPropagation(); editGroupName('${group.id}')">${group.name}</span>
                <span class="text-xs text-slate-400 bg-slate-100 px-2 py-0.5 rounded-full">${filteredCount}</span>
                ${group.expanded ? `<button onclick="event.stopPropagation(); addTaskToGroup('${group.id}')" class="ml-2 text-xs text-navy-500 hover:text-navy-700 hover:underline">+ ì—…ë¬´</button>` : ''}
              </div>
            </td>
            <td class="py-2.5 px-3">
              ${!group.expanded ? `<span class="status-tag ${gs.bg} ${gs.text}">â— ${gs.label}</span>` : ''}
            </td>
            <td class="py-2.5 px-3"></td>
            <td class="py-2.5 px-3"></td>
            <td class="py-2.5 px-3"></td>
            <td class="py-2.5 px-3"></td>
            <td class="py-2.5 px-3"></td>
          </tr>
        `;

        if (group.expanded) {
          // ë¹ˆ ê·¸ë£¹ì¼ ë•Œ ë©”ì‹œì§€ í‘œì‹œ
          if (group.tasks.length === 0) {
            html += `
              <tr class="border-b border-slate-50">
                <td colspan="7" class="py-4 px-4 text-center text-slate-400 text-sm">
                  ì—…ë¬´ê°€ ì—†ìŠµë‹ˆë‹¤. 
                  <button onclick="addTaskToGroup('${group.id}')" class="text-navy-500 hover:underline ml-1">+ ì—…ë¬´ ì¶”ê°€</button>
                </td>
              </tr>
            `;
          }
          
          group.tasks.forEach(task => {
            const showTask = filterTask(task) || (task.children && task.children.some(c => filterTask(c)));
            if (!showTask) return;
            
            const sc = statusConfig[task.status] || statusConfig.scheduled;
            const hasChildren = task.children && task.children.length > 0;
            const isExpanded = expandedTasks.has(task.id);

            html += `
              <tr class="task-row border-b border-slate-50 cursor-pointer" onclick="openPanel(${task.id})">
                <td class="py-2.5 px-4">
                  <div class="flex items-center gap-2">
                    ${hasChildren ? `
                      <button onclick="event.stopPropagation(); toggleTaskExpand(${task.id})" class="p-0.5 hover:bg-slate-200 rounded transition-colors">
                        <svg class="w-4 h-4 text-slate-400 expand-icon ${isExpanded ? '' : 'collapsed'}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                      </button>
                    ` : '<span class="w-5"></span>'}
                    <span class="text-slate-800">${task.name}</span>
                    ${hasChildren ? `<span class="text-xs text-slate-400">(${task.children.length})</span>` : ''}
                  </div>
                </td>
                <td class="py-2.5 px-3"><span class="status-tag ${sc.bg} ${sc.text}">â— ${sc.label}</span></td>
                <td class="py-2.5 px-3"><span class="px-2 py-0.5 bg-navy-500 text-white text-xs rounded">${(task.who || '').substring(0, 4)}</span></td>
                <td class="py-2.5 px-3 text-slate-500">${task.start || '-'}</td>
                <td class="py-2.5 px-3 text-slate-500">${task.end || '-'}</td>
                <td class="py-2.5 px-3">
                  <div class="flex items-center gap-1">
                    <div class="w-16 h-1.5 bg-slate-200 rounded-full overflow-hidden">
                      <div class="h-full ${task.progress === 100 ? 'bg-emerald-500' : 'bg-blue-500'} rounded-full transition-all" style="width: ${task.progress}%"></div>
                    </div>
                    <span class="text-xs text-slate-500">${task.progress}%</span>
                  </div>
                </td>
                <td class="py-2.5 px-3 text-slate-400 text-xs">${task.num}</td>
              </tr>
            `;

            if (hasChildren && isExpanded) {
              task.children.forEach(child => {
                if (!filterTask(child)) return;
                
                const csc = statusConfig[child.status] || statusConfig.scheduled;
                html += `
                  <tr class="child-task border-b border-slate-50 cursor-pointer" onclick="openPanel(${child.id})">
                    <td class="py-2 px-4 pl-12">
                      <div class="flex items-center gap-2">
                        <span class="text-slate-400 text-xs">â””</span>
                        <span class="text-slate-700">${child.name}</span>
                      </div>
                    </td>
                    <td class="py-2 px-3"><span class="status-tag ${csc.bg} ${csc.text}">â— ${csc.label}</span></td>
                    <td class="py-2 px-3"><span class="px-2 py-0.5 bg-slate-500 text-white text-xs rounded">${(child.who || '').substring(0, 4)}</span></td>
                    <td class="py-2 px-3 text-slate-500 text-xs">${child.start || '-'}</td>
                    <td class="py-2 px-3 text-slate-500 text-xs">${child.end || '-'}</td>
                    <td class="py-2 px-3">
                      <div class="flex items-center gap-1">
                        <div class="w-12 h-1 bg-slate-200 rounded-full overflow-hidden">
                          <div class="h-full ${child.progress === 100 ? 'bg-emerald-500' : 'bg-blue-500'} rounded-full" style="width: ${child.progress}%"></div>
                        </div>
                        <span class="text-xs text-slate-400">${child.progress}%</span>
                      </div>
                    </td>
                    <td class="py-2 px-3 text-slate-400 text-xs">${child.num}</td>
                  </tr>
                `;
              });
            }
          });
        }
      });

      tbody.innerHTML = html;
      document.getElementById('total-count').textContent = countFilteredTasks();
    }

    function addGroup() {
      const newId = 'g' + (groups.length + 1);
      groups.push({
        id: newId,
        name: 'ìƒˆ ê·¸ë£¹',
        expanded: true,
        tasks: []
      });
      renderTasks();
    }

    // ì´ˆê¸° ë Œë”ë§
    renderTasks();
    updateFilterCounts();
  </script>
</body>
</html>
